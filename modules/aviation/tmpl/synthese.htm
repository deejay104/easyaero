<!-- BEGIN: icone -->
	<img src="{path_module}/img/icn48_synthese.png" alt="" border=0 />
<!-- END: icone -->

<!-- BEGIN: infos -->

{aff_menu}

<!-- END: infos -->


<!-- BEGIN: corps -->
<style>
.form-check-label { min-width: 100px!important; }

@media (min-width: 576px) {
	.form-large label { min-width:500px; }
}
</style>

<FORM name="form_detail" method="post" action="{path_root}/aviation/synthese" enctype="multipart/form-data">
	<INPUT type="hidden" name="id" value="{form_id}">
	<INPUT type="hidden" name="idvol" value="{prev_idvol}">
	<INPUT type="hidden" name="uid" value="{prev_uid}">
	<INPUT type="hidden" name="form_data[idvol]" value="{form_idvol}">
	<INPUT type="hidden" name="form_data[uid_pilote]" value="{form_id_pilote}">
	<INPUT type="hidden" name="form_data[uid_instructeur]" value="{form_id_instructeur}">
	<INPUT type="hidden" name="form_data[uid_avion]" value="{form_id_avion}">
	<INPUT type="hidden" name="form_data[dte_vol]" value="{form_dte_vol}">
	<INPUT type="hidden" name="checktime" value="{form_checktime}">

<div class="row">
	<div class="col-md-12 border-top">
		<div class="d-flex ">
			<div class="ml-4 small">
				Dernière mise à  jour : {form_usr_maj} {form_dte_maj}
			</div>
		</div>
	</div>
</div>

<div class="row">
	<div class="grid-margin stretch-card">
		<div class="card">
			<div class="card-body">	
				<h5>FICHE DE SYNTHESE DE VOL</h5>

				<div class="form-group row">
					<label class="col-lg-3 col-form-label">Livret de formation</label><div class="col-lg-6">{form_idlivret}</div>
				</div>
				<div class="form-group row">
					<label class="col-lg-3 col-form-label">Eleve</label><div class="col-lg-6">{form_uid_pilote}</div>
				</div>
				<div class="form-group row">
					<label class="col-lg-3 col-form-label">Module</label><div class="col-lg-6">{form_module}</div>
				</div>
				<div class="form-group row">
					<label class="col-lg-3 col-form-label">Référence du programme</label><div class="col-lg-6">{form_refffa}</div>
				</div>
				<div class="form-group row">
					<label class="col-lg-3 col-form-label">Type de vol</label><div class="col-lg-6">{form_type}</div>
				</div>
				<div class="form-group row">
					<label class="col-lg-3 col-form-label">Conclusion du vol</label><div class="col-lg-6">{form_conclusion}</div>
				</div>

			</div>
		</div>
	</div>
</div>


<div class="row">
	<div class="grid-margin stretch-card">
		<div class="card">
			<div class="card-body">
				<div class="">
					<h5>THEMES</h5>

					{form_themes}
				</div>
	
				<div class="border-top pt-2">
					<h5>APPRECIATION GENERALE DU VOL</h5>
					{form_bilan_gen}
				</div>
	
				<div class="border-top pt-2">
					<h5>METEO DU JOUR</h5>
					{form_mto}
				</div>
			</div>
		</div>
	</div>
</div>


<div class="row">
	<div class="grid-margin stretch-card">
		<div class="card">
			<div class="card-body">	
				<h5>BRIEFING SOL : EXERCICES PEDAGOGIQUES</h5>

				<!-- BEGIN: lst_pedagogique -->
				<div id='exo_{aff_id}' style='{form_color}' class='form-group row form-hover' OnMouseOver="document.getElementById('del_{aff_id}').style.display='inline-block';" OnMouseOut="document.getElementById('del_{aff_id}').style.display='none';">
					<label class="col-lg-5 col-form-label">{aff_exo_description}{form_progref}</label>
					<div class="col-lg-5 form-inline">{form_progression}</div>
					<!-- BEGIN: lst_delete -->
					<div id='del_{aff_id}' style='display:none; float:right; padding-right:4px; padding-top:4px; width:20px; font-size:20px;'>
						<a href="" OnClick='deleteExo({aff_id});return false;'><i class="mdi mdi-close"></i></a>
					</div>
					<!-- END: lst_delete -->
				</div>
				<!-- END: lst_pedagogique -->

				<div id="affpedagogique">
				</div>
				<br />
				<!-- BEGIN: add_exercicepeda -->
				<input id="addexercicepeda" class="form-control">
				<br />
				<!-- END: add_exercicepeda -->
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="grid-margin stretch-card">
		<div class="card">
			<div class="card-body">	

			<h5>EXERCICES</h5>
			<!-- BEGIN: lst_exercice -->
			<div id='exo_{aff_id}' class='form-group row form-hover'  OnMouseOver="document.getElementById('del_{aff_id}').style.display='inline-block';" OnMouseOut="document.getElementById('del_{aff_id}').style.display='none';">
				<label class="col-lg-5 col-form-label">{aff_exo_description}</label>
				<div class="col-lg-5 form-inline">{form_progression}</div>
				<!-- BEGIN: lst_delete -->
				<div id='del_{aff_id}' style='display:none; float:right; padding-right:4px; padding-top:4px; width:20px; font-size:20px;'>
					<a href="" OnClick='deleteExo({aff_id});return false;'><i class="mdi mdi-close"></i></a>
				</div>
				<!-- END: lst_delete -->
			</div>
			<!-- END: lst_affexercice -->
			<div id="affexercices">
			</div>
			<br />
			<!-- BEGIN: add_exercice -->
			<input id="addexercice" class="form-control" >
			<br />
			<!-- END: add_exercice -->
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="grid-margin stretch-card">
		<div class="card">
			<div class="card-body">	
				<h5>PANNES</h5>

				<!-- BEGIN: lst_panne -->
				<div id='exo_{aff_id}' class='form-group row form-hover' OnMouseOver="document.getElementById('del_{aff_id}').style.display='inline-block';" OnMouseOut="document.getElementById('del_{aff_id}').style.display='none';">
					<label class="col-lg-5 col-form-label">{aff_exo_description}</label>
					<div class="col-lg-5 form-inline">{form_progression}</div>
					<!-- BEGIN: lst_delete -->
					<div id='del_{aff_id}' style='display:none; float:right; padding-right:4px; padding-top:4px; width:20px; font-size:20px;'>
						<a href='#' class='imgDelete' OnClick='deleteExo({aff_id});return false;'><i class="mdi mdi-close"></a>
					</div>
					<!-- END: lst_delete -->
				</div>
				<!-- END: lst_panne -->
				<div id="affpannes">
				</div>
				<br />
				<!-- BEGIN: add_panne -->
				<input id="addpanne" class="form-control">
				<br />
				<!-- END: add_panne -->
			</div>
		</div>
	</div>
</div>
	<br />

<div class="row">
	<div class="grid-margin stretch-card">
		<div class="card">
			<div class="card-body">	
				<h5>Non technique / Menace, Erreurs, Situation non désirées</h5>

				<div class="form-group row form-hover"><label class="col-lg-5 col-form-label">Gestion de la charge de travail</label><div class="col-lg-5 form-inline">{form_info_1}</div></div>
				<div class="form-group row form-hover"><label class="col-lg-5 col-form-label">Gestion des automatismes</label><div class="col-lg-5 form-inline">{form_info_2}</div></div>
				<div class="form-group row form-hover"><label class="col-lg-5 col-form-label">Gestion des risques - Prise de décisions</label><div class="col-lg-5 form-inline">{form_info_3}</div></div>
				<div class="form-group row form-hover"><label class="col-lg-5 col-form-label">Conscience de la situation</label><div class="col-lg-5 form-inline">{form_info_4}</div></div>
				<div class="form-group row form-hover"><label class="col-lg-5 col-form-label">Conscience de l’environnement en vol</label><div class="col-lg-5 form-inline">{form_info_5}</div></div>
			</div>
		</div>
	</div>
</div>	
<div class="row">
	<div class="grid-margin stretch-card">
		<div class="card">
			<div class="card-body">	
				<div class="row">
					<div class="col-md-5 form-group row ">
						<label class="col-lg-5 col-form-label">Nb Atterrissage</label><div class="col-lg-5">{form_nb_att}</div>
					</div>
					<div class="col-md-5 form-group row ">
						<label class="col-lg-5 col-form-label">Total Atterrissage</label><div class="col-lg-5 py-2">{form_total_att}</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-5 form-group row ">
						<label class="col-lg-5 col-form-label">Remise(s) des Gaz</label><div class="col-lg-5">{form_nb_rmg}</div>
					</div>
					<div class="col-md-5 form-group row ">
						<label class="col-lg-5 col-form-label">Total Remise des Gaz</label><div class="col-lg-5 py-2">{form_total_rmg}</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-5 form-group row ">
						<label class="col-lg-5 col-form-label">Formation théorique (min)</label><div class="col-lg-5">{form_tps_theo}</div>
					</div>
					<div class="col-md-5 form-group row ">
						<label class="col-lg-5 col-form-label">Total Formation théorique</label><div class="col-lg-5 py-2">{form_total_theo}</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>	


<!-- BEGIN: submit -->
<div class="row">
	<div class="grid-margin stretch-card">
		<div class="card">
			<div class="card-body">	
				<div class="form-inline">
					<input type="submit" name="fonc" id="enregistrer" class="btn btn-primary mb-2" value="Enregistrer">
					<input type="submit" name="fonc" id="annuler"  class="btn btn-light ml-2 mb-2"  value="Annuler">
				</div>
			</div>
		</div>
	</div>
</div>
<!-- END: submit -->

<div class="row">
	<div class="col-12 grid-margin">
		<div class="card">
			<div class="row">
				<div class="col-lg-4">
					<div class="card-body">
							<b>Date du vol</b><br />
							{form_dtevol}
					</div>
				</div>
				<div class="col-lg-4">
					<div class="card-body">
							<b>Durée</b><br />
							{form_duree}
					</div>
				</div>
				<div class="col-lg-4">
					<div class="card-body">
							<b>Cumul DC</b><br />
							{form_cumuldc}<br />
							<b>Cumul Solo</b><br />
							{form_cumulsolo}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-lg-6 grid-margin stretch-card">
		<div class="card">
			<div class="card-body">	
				<div class="row"><label class="col-lg-2">Instructeur</label><div class="col-lg-5">{form_instructeur}</div></div>
					<!-- BEGIN: signinst -->
					<input type="submit" class="btn btn-light"  name="fonc" value="Signature Instructeur">
					<!-- END: signinst -->
					<!-- BEGIN: signedinst -->
					Signé par {form_signinst_name} le {form_signinst_dte}<br />
					(Clé: {form_signinst_key})
					<!-- END: signedinst -->
			</div>
		</div>
	</div>

	<div class="col-lg-6 grid-margin stretch-card">
		<div class="card">
			<div class="card-body">	
				<div class="row"><label class="col-lg-2">Eleve</label><div class="col-lg-5">{form_eleve}</div></div>
					<!-- BEGIN: signeleve -->
					<input type="submit" class="btn btn-light"  name="fonc" value="Signature Elève">
					<!-- END: signeleve -->
					<!-- BEGIN: signedeleve -->
					Signé par {form_signeleve_name} le {form_signeleve_dte}<br />
					(Clé: {form_signeleve_key})
					<!-- END: signedeleve -->
			</div>
		</div>
	</div>
</div>	

</form>


<script>
	function deleteExo(id)
	{
		$.ajax({
			type: "GET",
			url: "{path_root}/api/v1/aviation/exercice/delete?id="+id,
			dataType: 'JSON',
			success: function(response) {
				$("#exo_"+id).text("");
			}
		});   
	}

	$(document).ready(function() {
	  $(window).keydown(function(event){
		if(event.keyCode == 13) {
		  <!-- event.preventDefault(); -->
		  <!-- return false; -->
		}
	  });
	});
	
	$("#addexercicepeda").autocomplete({
		source: "{path_root}/api/v1/aviation/exercice/peda",
		select: function(event, ui) {
			var txt="";
			value=ui.item;
			console.log(value);
			txt=txt+"<div class='form-inline form-large'><label>"+value.description+"</label> ";
			txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='V' "+((value.progression=='V') ? "checked" : "")+">Non Vu<i class='input-helper'></i></label></div>";
			txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='E' "+((value.progression=='E') ? "checked" : "")+">Etude<i class='input-helper'></i></label></div>";
			txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='A' "+((value.progression=='A') ? "checked" : "")+">Acquis<i class='input-helper'></i></label></div>";
			txt=txt+"</div>";
			
			if (value.type=="panne")
			{
				$("#affpannes").append(txt);
			}
			else if (value.type=="exercice")
			{
				$("#affexercices").append(txt);
			}
			else
			{
				$("#affpedagogique").append(txt);
			}
			ui.item.value="";
		},
		delay: 200
	});

	$("#addexercice").autocomplete({
		source: "{path_root}/api/v1/aviation/exercice/exercice",
		select: function(event, ui) {
			var txt="";
			value=ui.item;
			console.log(value);

			txt=txt+"<div class='form-inline form-large'><label>"+value.description+"</label> ";
			txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='V' "+((value.progression=='V') ? "checked" : "")+">Non Vu<i class='input-helper'></i></label></div>";
			txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='E' "+((value.progression=='E') ? "checked" : "")+">Etude<i class='input-helper'></i></label></div>";
			txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='A' "+((value.progression=='A') ? "checked" : "")+">Acquis<i class='input-helper'></i></label></div>";
			txt=txt+"</div>";
			
			if (value.type=="panne")
			{
				$("#affpannes").append(txt);
			}
			else if (value.type=="exercice")
			{
				$("#affexercices").append(txt);
			}
			else
			{
				$("#affpedagogique").append(txt);
			}
			ui.item.value="";
		},
		delay: 200
	});

	$("#addpanne").autocomplete({
		source: "{path_root}/api/v1/aviation/exercice/panne",
		select: function(event, ui) {
			var txt="";
			value=ui.item;
			console.log(value);
			txt=txt+"<div class='form-inline form-large'><label>"+value.description+"</label> ";
			txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='V' "+((value.progression=='V') ? "checked" : "")+">Non Vu<i class='input-helper'></i></label></div>";
			txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='E' "+((value.progression=='E') ? "checked" : "")+">Etude<i class='input-helper'></i></label></div>";
			txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='A' "+((value.progression=='A') ? "checked" : "")+">Acquis<i class='input-helper'></i></label></div>";
			txt=txt+"</div>";
			
			if (value.type=="panne")
			{
				$("#affpannes").append(txt);
			}
			else if (value.type=="exercice")
			{
				$("#affexercices").append(txt);
			}
			else
			{
				$("#affpedagogique").append(txt);
			}
			ui.item.value="";
		},
		delay: 200
	});

	$("#refffa").change(function() {
		var ref=$("#refffa").val();

		$.ajax({
			type: "GET",
			url: "{path_root}/api/v1/aviation/exercice?ref="+ref,
			dataType: 'JSON',

			success: function(response) {
				<!-- $("#affpedagogique").text(""); -->
				<!-- $("#affexercices").text(""); -->
				<!-- $("#affpannes").text(""); -->
				var txtpeda="";
				var txtexo="";
				var txtpanne="";
				if (response.length>0)
				{
					$.each(response, function (index, value) {

						txt="<div id='exo_"+value.id+"' class='form-inline form-large form-hover'><label>"+value.description+"</label> ";
						txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='V' "+((value.progression=='V') ? "checked" : "")+">Non Vu<i class='input-helper'></i></label></div>";
						txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='E' "+((value.progression=='E') ? "checked" : "")+">Etude<i class='input-helper'></i></label></div>";
						txt=txt+"<div class='form-check'><label class='form-check-label'><input type='radio' class='form-check-input' name='form_comp["+value.id+"][progression]' value='A' "+((value.progression=='A') ? "checked" : "")+">Acquis<i class='input-helper'></i></label></div>";
						txt=txt+"</div>";

						if (value.type=="peda")
						{
							txtpeda=txtpeda+txt;
						}
						if (value.type=="exercice")
						{
							txtexo=txtexo+txt;
						}
						if (value.type=="panne")
						{
							txtpanne=txtpanne+txt;
						}
					});
				}
				$("#affpedagogique").html(txtpeda);
				$("#affexercices").html(txtexo);
				$("#affpannes").html(txtpanne);
			}
		});

		$.ajax({
			type: "GET",
			url: "{path_root}/api/v1/aviation/exercice/theme?ref="+ref,
			dataType: 'JSON',

			success: function(response) {
				var txt="";
				$("#themes").text("");
				$("#themes").text(response.theme);
			}
		});
   
	});
</script>


<!-- END: corps -->
