<!-- BEGIN: icone -->
	<img src="{path_module}/img/icn48_synthese.png" alt="" border=0 />
<!-- END: icone -->

<!-- BEGIN: infos -->

{aff_menu}

<!-- END: infos -->


<!-- BEGIN: corps -->
<style>
#mto { width: 100%!important; }
.formulaireHover:hover { background-color: #{LineBackgroundHover}!important; }
</style>

<FORM name="form_detail" method="post" action="{path_root}/index.php" enctype="multipart/form-data">
	<INPUT type="hidden" name="mod" value="aviation">
	<INPUT type="hidden" name="rub" value="synthese">
	<INPUT type="hidden" name="id" value="{form_id}">
	<INPUT type="hidden" name="idvol" value="{prev_idvol}">
	<INPUT type="hidden" name="uid" value="{prev_uid}">
	<INPUT type="hidden" name="form_data[idvol]" value="{form_idvol}">
	<INPUT type="hidden" name="form_data[uid_pilote]" value="{form_uid_pilote}">
	<INPUT type="hidden" name="form_data[uid_instructeur]" value="{form_uid_instructeur}">
	<INPUT type="hidden" name="form_data[uid_avion]" value="{form_uid_avion}">
	<INPUT type="hidden" name="form_data[dte_vol]" value="{form_dte_vol}">
	<INPUT type="hidden" name="checktime" value="{form_checktime}">

	<p class="lastupdate">Dernière mise à  jour : {form_usr_maj} {form_dte_maj}</p>

	<div class='formulaireTitre'>
		FICHE DE SYNTHESE DE VOL
	</div>

	<div class='formulaire formulaireLarge'>
		<p><label>Livret de formation</label>{form_idlivret}</p>
		<p><label>Module</label>{form_module}</p>
		<p><label>Référence du programme</label>{form_refffa}</p>
		<p><label>Type de vol</label>{form_type}</p>
		<p><label>Conclusion du vol</label>{form_conclusion}</p>
	</div>

	<div class='formulaireTitre'>THEMES</div>
	<div class='formulaire'>
	{form_themes}
	</div>
	
	<div class='formulaireTitre'>APPRECIATION GENERALE DU VOL</div>
	<div class='formulaire'>
	{form_bilan_gen}
	</div>

	<div class='formulaireTitre'>METEO DU JOUR</div>
	<div class='formulaire'>
	{form_mto}
	</div>

	<div class='formulaireTitre'>BRIEFING SOL : EXERCICES PEDAGOGIQUES</div>
	<div class='formulaire'>
<!-- BEGIN: lst_pedagogique -->
		<div id='exo_{aff_id}' style='{form_color}' class='formulaireHover' OnMouseOver="document.getElementById('del_{aff_id}').style.display='inline-block';" OnMouseOut="document.getElementById('del_{aff_id}').style.display='none';">
		<div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>{aff_exo_description}</div>
		<div style='display:inline-block;'>{form_progression} {form_progref}</div>
<!-- BEGIN: lst_delete -->
		<div id='del_{aff_id}' style='display:none; float:right; padding-right:4px; padding-top:4px'>
			<a href='#' class='imgDelete' OnClick='deleteExo({aff_id});return false;'><img src='{path_root}/{path_module}/img/icn16_supprimer.png'></a>
		</div>
<!-- END: lst_delete -->
		</div>
<!-- END: lst_pedagogique -->

		<div id="affpedagogique">
		</div>
		<br />
<!-- BEGIN: add_exercicepeda -->
		<input id="addexercicepeda" style="width:500px!important;">
		<br />
<!-- END: add_exercicepeda -->
	</div>

	<div class='formulaireTitre'>EXERCICES</div>
	<div class='formulaire'>
<!-- BEGIN: lst_exercice -->
		<div id='exo_{aff_id}' class='formulaireHover'  OnMouseOver="document.getElementById('del_{aff_id}').style.display='inline-block';" OnMouseOut="document.getElementById('del_{aff_id}').style.display='none';">
		<div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>{aff_exo_description}</div>
		{form_progression}
<!-- BEGIN: lst_delete -->
		<div id='del_{aff_id}' style='display:none; float:right; padding-right:4px; padding-top:4px'>
			<a href='#' class='imgDelete' OnClick='deleteExo({aff_id});return false;'><img src='{path_root}/{path_module}/img/icn16_supprimer.png'></a>
		</div>
<!-- END: lst_delete -->
		</div>
<!-- END: lst_affexercice -->
	<div id="affexercices">
	</div>
	<br />
<!-- BEGIN: add_exercice -->
	<input id="addexercice" style="width:500px!important;">
	<br />
<!-- END: add_exercice -->
	</div>

	<div class='formulaireTitre'>PANNES</div>
	<div class='formulaire'>
<!-- BEGIN: lst_panne -->
		<div id='exo_{aff_id}' class='formulaireHover' OnMouseOver="document.getElementById('del_{aff_id}').style.display='inline-block';" OnMouseOut="document.getElementById('del_{aff_id}').style.display='none';">
		<div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>{aff_exo_description}</div>
		{form_progression}
		<div id='del_{aff_id}' style='display:none; float:right; padding-right:4px; padding-top:4px'>
			<a href='#' class='imgDelete' OnClick='deleteExo({aff_id});return false;'><img src='{path_root}/{path_module}/img/icn16_supprimer.png'></a>
		</div>
<!-- BEGIN: lst_delete -->
		<div id='del_{aff_id}' style='display:none; float:right; padding-right:4px; padding-top:4px'>
			<a href='#' class='imgDelete' OnClick='deleteExo({aff_id});return false;'><img src='{path_root}/{path_module}/img/icn16_supprimer.png'></a>
		</div>
<!-- END: lst_delete -->
		</div>
<!-- END: lst_panne -->
		<div id="affpannes">
		</div>
		<br />
<!-- BEGIN: add_panne -->
		<input id="addpanne" style="width:500px!important;">
		<br />
<!-- END: add_panne -->
	</div>

	<br />


	<div class='formulaireTitre'>Non technique / Menace, Erreurs, Situation non désirées</div>

	<div class='formulaire'>
		<div class='formulaireHover'><div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>Gestion de la charge de travail</div>{form_info_1}</div>
		<div class='formulaireHover'><div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>Gestion des automatismes</div>{form_info_2}</div>
		<div class='formulaireHover'><div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>Gestion des risques - Prise de décisions</div>{form_info_3}</div>
		<div class='formulaireHover'><div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>Conscience de la situation</div>{form_info_4}</div>
		<div class='formulaireHover'><div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>Conscience de l’environnement en vol</div>{form_info_5}</div>
	</div>
	
	<br />
	<table class='formulaireTableau formulaire'>
		<tr>
			<th width=200>Nb Atterrissage</th>
			<th width=200>Total Atterrissage</th>
			<th width=200>Remise(s) des Gaz</th>
			<th width=200>Total RMG</th>
		</tr>
		<tr>
			<td>{form_nb_att}</td>
			<td>{form_total_att}</td>
			<td>{form_nb_rmg}</td>
			<td>{form_total_rmg}</td>
		</tr>
	</table>
<script>
	function deleteExo(id)
	{
		$.ajax({
			type: "GET",
			url: "{path_root}/api/v1/aviation/exercice/delete?id="+id,
			dataType: 'JSON',
			success: function(response) {
				$("#exo_"+id).text("");
			}
		});   
	}

	$(document).ready(function() {
	  $(window).keydown(function(event){
		if(event.keyCode == 13) {
		  <!-- event.preventDefault(); -->
		  <!-- return false; -->
		}
	  });
	});
	
	$("#addexercicepeda").autocomplete({
		source: "{path_root}/api/v1/aviation/exercice/peda",
		select: function(event, ui) {
			var txt="";
			value=ui.item;
			console.log(value);
			txt=txt+"<div><div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>"+value.description+"</div> ";
			txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='V' "+((value.progression=='V') ? "checked" : "")+">Non Vu ";
			txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='E' "+((value.progression=='E') ? "checked" : "")+">Etude ";
			txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='A' "+((value.progression=='A') ? "checked" : "")+">Acquis ";
			txt=txt+"</div>";
			
			if (value.type=="panne")
			{
				$("#affpannes").append(txt);
			}
			else if (value.type=="exercice")
			{
				$("#affexercices").append(txt);
			}
			else
			{
				$("#affpedagogique").append(txt);
			}
			ui.item.value="";
		},
		delay: 200
	});

	$("#addexercice").autocomplete({
		source: "{path_root}/api/v1/aviation/exercice/exercice",
		select: function(event, ui) {
			var txt="";
			value=ui.item;
			console.log(value);
			txt=txt+"<div><div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>"+value.description+"</div> ";
			txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='V' "+((value.progression=='V') ? "checked" : "")+">Non Vu ";
			txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='E' "+((value.progression=='E') ? "checked" : "")+">Etude ";
			txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='A' "+((value.progression=='A') ? "checked" : "")+">Acquis ";
			txt=txt+"</div>";
			
			if (value.type=="panne")
			{
				$("#affpannes").append(txt);
			}
			else if (value.type=="exercice")
			{
				$("#affexercices").append(txt);
			}
			else
			{
				$("#affpedagogique").append(txt);
			}
			ui.item.value="";
		},
		delay: 200
	});

	$("#addpanne").autocomplete({
		source: "{path_root}/api/v1/aviation/exercice/panne",
		select: function(event, ui) {
			var txt="";
			value=ui.item;
			console.log(value);
			txt=txt+"<div><div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>"+value.description+"</div> ";
			txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='V' "+((value.progression=='V') ? "checked" : "")+">Non Vu ";
			txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='E' "+((value.progression=='E') ? "checked" : "")+">Etude ";
			txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='A' "+((value.progression=='A') ? "checked" : "")+">Acquis ";
			txt=txt+"</div>";
			
			if (value.type=="panne")
			{
				$("#affpannes").append(txt);
			}
			else if (value.type=="exercice")
			{
				$("#affexercices").append(txt);
			}
			else
			{
				$("#affpedagogique").append(txt);
			}
			ui.item.value="";
		},
		delay: 200
	});

	$("#refffa").change(function() {
		var ref=$("#refffa").val();

		$.ajax({
			type: "GET",
			url: "{path_root}/api/v1/aviation/exercice?ref="+ref,
			dataType: 'JSON',

			success: function(response) {
				<!-- $("#affpedagogique").text(""); -->
				<!-- $("#affexercices").text(""); -->
				<!-- $("#affpannes").text(""); -->
				var txtpeda="";
				var txtexo="";
				var txtpanne="";
				if (response.length>0)
				{
					$.each(response, function (index, value) {
						txt="<div id='exo_"+value.id+"' class='formulaireHover'><div style='width:500px; display:inline-block; padding-top:2px; padding-bottom:2px;'>"+value.description+"</div> ";
						txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='V' "+((value.progression=='V') ? "checked" : "")+">Non Vu ";
						txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='E' "+((value.progression=='E') ? "checked" : "")+">Etude ";
						txt=txt+"<input type='radio' name='form_comp["+value.id+"][progression]' value='A' "+((value.progression=='A') ? "checked" : "")+">Acquis ";
						txt=txt+"</div>";
						if (value.type=="peda")
						{
							txtpeda=txtpeda+txt;
						}
						if (value.type=="exercice")
						{
							txtexo=txtexo+txt;
						}
						if (value.type=="panne")
						{
							txtpanne=txtpanne+txt;
						}
					});
				}
				$("#affpedagogique").html(txtpeda);
				$("#affexercices").html(txtexo);
				$("#affpannes").html(txtpanne);
			}
		});

		$.ajax({
			type: "GET",
			url: "{path_root}/api/v1/aviation/exercice/theme?ref="+ref,
			dataType: 'JSON',

			success: function(response) {
				var txt="";
				$("#themes").text("");
				$("#themes").text(response.theme);
			}
		});
   
	});
</script>

	
<!-- BEGIN: submit -->
	<div class="formulaireSubmit" style=" padding-left:55px;">
		<input type="submit" name="fonc" id="enregistrer" value="Enregistrer">
		<input type="submit" name="fonc" id="annuler" value="Annuler">
	</div>
	<br />
<!-- END: submit -->

	<div class='formulaireTitre'>
		VISAS
	</div>
	<table width='100%'>
	<tr>
		<td width='15%'>
			<div class='formulaire' style='height:140px;'>
			<b>Date du vol</b><br />
			{form_dtevol}
			</div>
		</td>
		<td width='10%'>
			<div class='formulaire' style='margin-left:10px; height:140px;'>
			<b>Durée</b><br />
			{form_duree}
			</div>
		</td>
		<td width='10%'>
			<div class='formulaire' style='margin-left:10px; height:140px;'>
			<b>Cumul DC</b><br />
			{form_cumuldc}<br />
			<b>Cumul Solo</b><br />
			{form_cumulsolo}
			</div>
		</td>
		<td width='33%'>
			<div class='formulaire' style='margin-left:10px; height:140px;'>
				<b>Instructeur</b> : {form_instructeur}<br />
<!-- BEGIN: signinst -->
				<input type="submit" name="fonc" value="Signature Instructeur">
<!-- END: signinst -->
<!-- BEGIN: signedinst -->
				<br />Signé par {form_signinst_name} le {form_signinst_dte}<br />
				(Clé: {form_signinst_key})
<!-- END: signedinst -->
			</div>
		</td>
		<td>
			<div class='formulaire' style='margin-left:10px; height:140px;'>
				<b>Eleve</b> : {form_eleve}<br />
<!-- BEGIN: signeleve -->
				<input type="submit" name="fonc" value="Signature Elève">
<!-- END: signeleve -->
<!-- BEGIN: signedeleve -->
				<br />Signé par {form_signeleve_name} le {form_signeleve_dte}<br />
				(Clé: {form_signeleve_key})
<!-- END: signedeleve -->
			</div>
		</td>
	</tr>
	</table>
</form>
<br />

<!-- END: corps -->
